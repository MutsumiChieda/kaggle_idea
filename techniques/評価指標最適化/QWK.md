# [QWK解説](https://note.com/maxwell/n/n2f3d7c6476d9)

## TL;DR

QWKでは，分母の$E_{ij}$の計算時に予測データのクラス分布を使用することに注意してモデル作成する必要がある．

---

QWKは，順序つきの多値分類問題の指標で，予測を大きく外すほど大きなペナルティが与えられる．  
混同行列は大体つぎのように配置される．  
|($w_{ij}$)Actual|c1|c2|c3|
|-|-|-|-|
predction|
c1|0|1|4
c2|1|0|1
c3|4|1|0

真のラベルの分布に沿った形で予測しないと最適な結果が得られない厄介な指標．  

$$QWK = 1- \frac{\sum_{ij} w_{ij} O_{ij}}{\sum_{ij}w_{ij}E_{ij}}$$

- $w_{ij}$は予測を外した時のペナルティ(主催者が設定する),  
- $O_{ij}$は正解のクラスが$i$で予測のクラスが$j$のレコード数,  
- $E_{ij}$は正解・予測の各クラスの割合を固定したままランダムに予測すると，どれだけのレコード数が割り当てられるかを計算したもの．  
正解のクラスが i である割合 × 予測のクラスが j である割合 × データ全体のレコード数で計算される．

$E_{ij}$について，レコード数が以下のとおりとすると，このように計算される．
$$E_{11}=\frac{20}{100} \times \frac{30}{100} \times 100 = 6$$
|($E_{ij}$)Actual|c1|c2|c3|$\sum$
|-|-|-|-|-|
predction|
c1|6|8|6|__20__
c2|12|16|12|40
c3|12|16|12|40
$\sum$|__30__|40|30|__100__

